<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="managerNamespace">

    <!--映射表resultMap property为Entity里的属性名 column为表中的列名 @Column(name = "wx_username")-->
    <!--  获取首页内容，无参数  -->
    <resultMap type="xyz.dgel.Model.ViewModel.ManagerHomepageCourseInfoListView" id="managerMap">
        <id property="course_id" column="co.course_id"/>
        <result property="course_name" column="course_name"/>
        <result property="year" column="course_year"/>
        <result property="teacher_name" column="name"/>
        <result property="class_name" column="class_name"/>
        <result property="course_desc" column="course_desc"/>
        <result property="student_count" column="student_count"/>
    </resultMap>
    <select id="getManagerList" resultMap="managerMap">
        SELECT DISTINCT  co.course_id,course_name,course_year,name,class_name,course_desc,(SELECT COUNT(*) FROM Student WHERE Student.class_id = cl.class_id) as student_count
        FROM CotoCl ctc
        INNER JOIN Course co ON ctc.course_id = co.course_id
        INNER JOIN Class cl ON ctc.class_id = cl.class_id
        INNER JOIN `User` u ON ctc.teacher_id = u.user_id
        INNER JOIN CoTime ct ON ctc.cotocl_num = ct.cotocl_num
    </select>

    <!--插入课程信息 使用实体类CotoClEntity-->
    <insert id="addCourseInfo" parameterType="xyz.dgel.Model.EF.CotoClEntity">
        insert into CotoCl(cotocl_num,class_id,course_id,teacher_id) values(null,#{classId},#{courseId},#{teacherId})
    </insert>

    <!--根据班级名称查询班级ID-->
    <resultMap id="getclassidbyname" type="java.lang.String">
        <result property="class_id" column="class_id"></result>
    </resultMap>
    <select id="getClassId" resultMap="getclassidbyname" parameterType="java.lang.String">
        select class_id from Class where class_name = #{class_name}
    </select>


    <!--根据课程名称查询课程ID-->
    <resultMap id="getcourseidbyname" type="java.lang.String">
        <result property="course_id" column="course_id"></result>
    </resultMap>
    <select id="getCourseId" resultMap="getcourseidbyname" parameterType="java.lang.String">
        select course_id from Class where course_name = #{course_name}
    </select>

    <!--根据课程名称查询课程ID-->
    <resultMap id="getteacheridbyname" type="java.lang.String">
        <result property="teacher_id" column="teacher_id"></result>
    </resultMap>
    <select id="getTeacherId" resultMap="getteacheridbyname" parameterType="java.lang.String">
        select teacher_id from Class where teacher_name = #{teacher_name}
    </select>

</mapper>